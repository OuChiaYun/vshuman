<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Chat Avatar</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
    <!-- Tailwind via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
  </head>
  <body class="min-h-screen bg-slate-100 text-slate-900 antialiased">
    <div class="max-w-6xl mx-auto px-4 py-6 flex flex-col gap-6">
      <!-- Header -->
      <header class="text-center space-y-1">
        <!-- <h1 class="text-3xl font-bold tracking-tight">AI Avatar Chat</h1> -->
        <!-- <p class="subtitle text-sm text-slate-500">
          Chat with voice or text - powered by Gemini
        </p> -->
        <!-- https://www.svgrepo.com/svg/456911/shop-cart?edit=true -->
        <div
          class="bg-sky-600 text-slate-100 rounded-2xl shadow-md flex flex-col text-xs"
        >
          <div
            class="px-3 py-2 border-slate-700 font-semibold flex justify-between items-center"
          >
            <p class="text-xl">ShopStream</p>
            <!-- <p>System Log:</p> -->
            <div class="flex gap-4 justify-center">
              <div>
                <svg
                  width="30px"
                  height="30px"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="#ffee00"
                  stroke="#ffee00"
                >
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g
                    id="SVGRepo_tracerCarrier"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></g>
                  <g id="SVGRepo_iconCarrier">
                    <defs>
                      <style>
                        .cls-1 {
                          fill: none;
                          stroke: #ffffff;
                          stroke-miterlimit: 10;
                          stroke-width: 1.91px;
                        }
                      </style>
                    </defs>
                    <g id="cart">
                      <circle
                        class="cls-1"
                        cx="10.07"
                        cy="20.59"
                        r="1.91"
                      ></circle>
                      <circle
                        class="cls-1"
                        cx="18.66"
                        cy="20.59"
                        r="1.91"
                      ></circle>
                      <path
                        class="cls-1"
                        d="M.52,1.5H3.18a2.87,2.87,0,0,1,2.74,2L9.11,13.91H8.64A2.39,2.39,0,0,0,6.25,16.3h0a2.39,2.39,0,0,0,2.39,2.38h10"
                      ></path>
                      <polyline
                        class="cls-1"
                        points="7.21 5.32 22.48 5.32 22.48 7.23 20.57 13.91 9.11 13.91"
                      ></polyline>
                    </g>
                  </g>
                </svg>
              </div>
              <div>
                <svg
                  width="30px"
                  height="30px"
                  viewBox="0 0 24 24"
                  id="Layer_1"
                  data-name="Layer 1"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="#ffffff"
                  stroke="#ffffff"
                >
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g
                    id="SVGRepo_tracerCarrier"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></g>
                  <g id="SVGRepo_iconCarrier">
                    <defs>
                      <style>
                        .cls-1 {
                          fill: none;
                          stroke: #ffffff;
                          stroke-miterlimit: 10;
                          stroke-width: 1.91px;
                        }
                      </style>
                    </defs>
                    <rect
                      class="cls-1"
                      x="1.5"
                      y="4.36"
                      width="21"
                      height="15.27"
                    ></rect>
                    <polyline
                      class="cls-1"
                      points="1.5 4.36 12 14.86 22.5 4.36"
                    ></polyline>
                    <line
                      class="cls-1"
                      x1="9.14"
                      y1="12"
                      x2="1.5"
                      y2="19.64"
                    ></line>
                    <line
                      class="cls-1"
                      x1="22.5"
                      y1="19.64"
                      x2="14.86"
                      y2="12"
                    ></line>
                    <rect
                      class="cls-1"
                      x="1.5"
                      y="4.36"
                      width="21"
                      height="15.27"
                    ></rect>
                  </g>
                </svg>
              </div>
              <div class="flex justify-center items-center border-b gap-1">
                <svg
                  width="30px"
                  height="30px"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  stroke="#ffffff"
                >
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g
                    id="SVGRepo_tracerCarrier"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></g>
                  <g id="SVGRepo_iconCarrier">
                    <path
                      d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z"
                      stroke="#ffffff"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    ></path>
                    <path
                      d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z"
                      stroke="#ffffff"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    ></path>
                  </g>
                </svg>
                <p>USER_123456</p>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Main layout -->
      <main
        class="flex-1 grid gap-6 lg:grid-cols-[minmax(0,1.3fr)_minmax(0,1fr)] items-start"
      >
        <!-- 3D Avatar Canvas -->
        <div class="w-full h-full">
          <div
            class="avatar-container relative bg-slate-900/90 rounded-2xl shadow-lg overflow-hidden flex items-center justify-center aspect-video w-full h-full"
          >
            <!-- live  -->
            <div
              id="live"
              class="absolute top-3 right-3 z-10 inline-flex items-center justify-center rounded-full px-3 py-1.5 text-xs font-semibold bg-red-500 text-white shadow-sm"
            >
              LIVE
            </div>

            <!-- 3D avatar -->
            <div id="avatar" class="w-full h-full"></div>
          </div>
        </div>

        <!-- Status / logs / transcript -->
        <div class="status-panel flex flex-col gap-4">
          <!-- Status Display -->
          <div
            class="status-indicator flex items-center gap-2 px-3 py-2 rounded-full bg-slate-800 text-slate-100 shadow"
          >
            <span
              id="statusDot"
              class="status-dot inline-block h-3 w-3 rounded-full bg-slate-400"
            ></span>
            <span
              id="statusText"
              class="status-text text-sm font-medium truncate"
            >
              Click Start to begin
            </span>
          </div>

          <!-- Transcript -->
          <div
            id="transcript"
            class="transcript bg-white rounded-2xl shadow-md border border-slate-200 h-56 overflow-y-auto px-4 py-3 leading-relaxed"
          >
            <div class="text-slate-400 border-b font-bold text-l">
              Live Chat
            </div>
          </div>
          <!-- Text Input -->
          <div
            class="text-input-container flex gap-3 items-center mt-2 bg-white border border-slate-200 rounded-2xl px-4 py-3 shadow-sm"
          >
            <input
              type="text"
              id="textInput"
              class="text-input flex-1 bg-transparent outline-none text-sm placeholder:text-slate-400 disabled:text-slate-400"
              placeholder="Type your message here (or use voice)..."
              disabled
            />
            <button
              id="sendBtn"
              disabled
              class="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium text-slate-500 disabled:text-slate-300 disabled:cursor-not-allowed enabled:hover:text-sky-600 enabled:hover:cursor-pointer transition-colors"
            >
              <svg
                class="w-6 h-6"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.5003 12H5.41872M5.24634 12.7972L4.24158 15.7986C3.69128 17.4424 3.41613 18.2643 3.61359 18.7704C3.78506 19.21 4.15335 19.5432 4.6078 19.6701C5.13111 19.8161 5.92151 19.4604 7.50231 18.7491L17.6367 14.1886C19.1797 13.4942 19.9512 13.1471 20.1896 12.6648C20.3968 12.2458 20.3968 11.7541 20.1896 11.3351C19.9512 10.8529 19.1797 10.5057 17.6367 9.81135L7.48483 5.24303C5.90879 4.53382 5.12078 4.17921 4.59799 4.32468C4.14397 4.45101 3.77572 4.78336 3.60365 5.22209C3.40551 5.72728 3.67772 6.54741 4.22215 8.18767L5.24829 11.2793C5.34179 11.561 5.38855 11.7019 5.407 11.8459C5.42338 11.9738 5.42321 12.1032 5.40651 12.231C5.38768 12.375 5.34057 12.5157 5.24634 12.7972Z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </button>
          </div>
          <!-- Controls -->
          <div class="controls flex flex-wrap gap-3 mt-1 justify-between">
            <button
              id="startBtn"
              class="enabled:hover:cursor-pointer btn btn-primary inline-flex items-center justify-center rounded-full px-5 py-2.5 text-sm font-semibold bg-emerald-600 text-white shadow-sm hover:bg-emerald-700 transition"
            >
              Start Chat
            </button>

            <button
              id="voiceBtn"
              class="enabled:hover:cursor-pointer btn btn-voice inline-flex items-center justify-center rounded-full px-4 py-2.5 text-sm font-medium bg-indigo-600 text-white shadow-sm hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition"
              disabled
            >
              üé§ Start Voice
            </button>

            <button
              id="stopBtn"
              class="enabled:hover:cursor-pointer btn btn-secondary inline-flex items-center justify-center rounded-full px-4 py-2.5 text-sm font-medium bg-slate-200 text-slate-900 shadow-sm hover:bg-slate-300 disabled:bg-slate-200 disabled:text-slate-400 disabled:cursor-not-allowed transition"
              disabled
            >
              Stop
            </button>
          </div>
        </div>
      </main>

      <!-- ---->

      <div class="w-full flex items-center gap-2 mt-4">
        <!-- Â∑¶ÁÆ≠È†≠ÔºöÂè™ÊéßÂà∂Êç≤Âãï -->
        <button
          id="cardPrev"
          type="button"
          class="flex items-center justify-center w-8 h-20 bg-slate-200 hover:bg-slate-300 rounded-md"
        >
          <svg
            class="w-3 h-3 text-black"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M15 4L7 12L15 20" />
          </svg>
        </button>

        <!-- ÊßΩ‰ΩçËªåÈÅìÔºåÂç°ÁâáÁî® JS Â°û -->
        <div
          id="cardTrack"
          class="flex-1 flex items-center gap-3 overflow-x-auto px-1"
        ></div>

        <!-- Âè≥ÁÆ≠È†≠ÔºöÂè™ÊéßÂà∂Êç≤Âãï -->
        <button
          id="cardNext"
          type="button"
          class="flex items-center justify-center w-8 h-20 bg-slate-200 hover:bg-slate-300 rounded-md"
        >
          <svg
            class="w-3 h-3 text-black"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M9 4L17 12L9 20" />
          </svg>
        </button>
      </div>

      <div class="mt-4 border border-slate-200 rounded-md overflow-hidden">
        <div class="flex items-center justify-between bg-sky-200 px-3 py-2">
          <div class="flex-1 max-w-md relative">
            <input
              type="text"
              placeholder="Search..."
              class="w-full h-8 rounded-sm pl-3 pr-8 text-sm border border-sky-300 outline-none"
            />
            <svg
              class="w-4 h-4 text-slate-500 absolute right-2 top-1/2 -translate-y-1/2"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="7" />
              <line x1="16.65" y1="16.65" x2="21" y2="21" />
            </svg>
          </div>

          <div class="flex items-center gap-1 ml-4">
            <button
              class="w-6 h-6 flex items-center justify-center bg-black text-white text-xs rounded-sm"
            >
              ‚Äπ
            </button>
            <button
              class="w-6 h-6 flex items-center justify-center bg-red-500 text-white text-xs rounded-sm"
            >
              1
            </button>
            <button
              class="w-6 h-6 flex items-center justify-center bg-white text-slate-900 text-xs rounded-sm"
            >
              2
            </button>
            <button
              class="w-6 h-6 flex items-center justify-center bg-white text-slate-900 text-xs rounded-sm"
            >
              3
            </button>
            <button
              class="w-6 h-6 flex items-center justify-center bg-white text-slate-900 text-xs rounded-sm"
            >
              4
            </button>
            <button
              class="w-6 h-6 flex items-center justify-center bg-white text-slate-900 text-xs rounded-sm"
            >
              5
            </button>
            <span class="text-xs">‚Ä¶</span>
            <button
              class="w-6 h-6 flex items-center justify-center bg-black text-white text-xs rounded-sm"
            >
              ‚Ä∫
            </button>
          </div>
        </div>

        <!-- ÂïÜÂìÅÁ∂≤Ê†ºÔºöÁî® JS Â°û -->
        <div
          id="productGrid"
          class="grid grid-cols-5 gap-4 px-4 py-4 bg-slate-100"
        ></div>
      </div>

      <!--  -->
      <!-- Debug console -->
      <div
        id="debugConsole"
        class="debug-console bg-slate-900 text-slate-100 rounded-2xl shadow-md flex flex-col h-40 text-xs"
      >
        <div
          class="debug-title px-3 py-2 border-b border-slate-700 font-semibold"
        >
          System Log:
        </div>
        <div
          id="debugMessages"
          class="debug-messages flex-1 overflow-y-auto px-3 py-2 space-y-1"
        ></div>
      </div>

      <!-- API Key note -->
      <div class="settings hidden">
        <small class="text-xs text-slate-500">
          API key loaded securely from server .env file
        </small>
      </div>

      <footer class="pt-2 text-center text-xs text-slate-500">
        <p>Built with TalkingHead.js, Three.js, and Gemini Live API</p>
      </footer>
    </div>

    <!-- Three.js and TalkingHead.js from CDN -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.180.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/",
          "TalkingHead": "https://cdn.jsdelivr.net/gh/met4citizen/TalkingHead@1.6/modules/talkinghead.mjs",
          "wawa-lipsync": "./node_modules/wawa-lipsync/dist/wawa-lipsync.es.js"
        }
      }
    </script>
    <script type="module" src="app.js"></script>

    <script>
      // ------- ‰∏äÈù¢ÊßΩ‰ΩçÂàó -------

      const cardTrack = document.getElementById("cardTrack");
      const prevBtn = document.getElementById("cardPrev");
      const nextBtn = document.getElementById("cardNext");
      const productGrid = document.getElementById("productGrid");

      const TOTAL_SLOTS = 10;
      const slots = [];
      const slotData = new Array(TOTAL_SLOTS).fill(null); // ÊØèÂÄãÊßΩ‰ΩçÂ≠òÊîæÁöÑÂïÜÂìÅ
      let currentSlot = 0; // ÁõÆÂâçÈÅ∏‰∏≠ÁöÑÊßΩ‰Ωç

      const SLOT_BASE_CLASS =
        "card-item flex-shrink-0 w-32 h-20 rounded-2xl enabled:hover:cursor-pointer " +
        "flex flex-col items-center justify-center text-[11px] leading-tight";

      function renderSlots() {
        slots.forEach((slot, i) => {
          const data = slotData[i];
          const isSelected = i === currentSlot;

          // Â•óÊ®£Âºè
          slot.className =
            SLOT_BASE_CLASS +
            " " +
            (isSelected
              ? "bg-slate-300 border-[3px] border-black enabled:hover:cursor-pointer "
              : "bg-slate-200 border border-transparent");

          // ÂÖßÂÆπÔºöÊúâÂïÜÂìÅÂ∞±È°ØÁ§∫ÂïÜÂìÅÂêçÁ®± + ÂÉπÊ†ºÔºåÊ≤íÊúâÂ∞±È°ØÁ§∫ Slot n
          if (data) {
            slot.innerHTML = `
          <div class="font-semibold truncate max-w-[7rem]">${data.name}</div>
          <div class="text-[10px] text-slate-700">$${data.price}</div>
        `;
          } else {
            slot.innerHTML = `<div class="text-slate-500">Slot ${i + 1}</div>`;
          }
        });
      }

      // Âª∫Á´ã 10 ÂÄãÊßΩ‰ΩçÊåâÈàï
      for (let i = 0; i < TOTAL_SLOTS; i++) {
        const btn = document.createElement("button");
        btn.dataset.slotIndex = i;
        btn.addEventListener("click", () => {
          currentSlot = i; // ÊîπËÆäÁõÆÂâçÈÅ∏‰∏≠ÁöÑÊßΩ‰Ωç
          renderSlots();
        });

        slots.push(btn);
        cardTrack.appendChild(btn);
      }

      // Â∑¶Âè≥ÁÆ≠È†≠ÔºöÂè™ÊéßÂà∂Êç≤Âãï
      function scrollTrack(dir) {
        const amount = cardTrack.clientWidth * 0.8;
        cardTrack.scrollBy({
          left: dir * amount,
          behavior: "smooth",
        });
      }

      prevBtn.addEventListener("click", () => scrollTrack(-1));
      nextBtn.addEventListener("click", () => scrollTrack(1));

      // ÂàùÂßãÂåñÊßΩ‰ΩçÈ°ØÁ§∫
      renderSlots();

      // ------- ‰∏ãÈù¢ÂïÜÂìÅÁ∂≤Ê†º -------

      // ÂÅáÂïÜÂìÅË≥áÊñô
      const products = Array.from({ length: 20 }, (_, i) => ({
        id: i,
        name: `Item ${i + 1}`,
        price: (10000000 + i * 1000).toLocaleString(),
      }));

      function createProductCard(product) {
        const card = document.createElement("button");
        card.className =
          "w-40 h-44 bg-slate-200 rounded-2xl overflow-hidden enabled:hover:cursor-pointer " +
          "flex flex-col shadow-sm hover:shadow-md transition";

        card.innerHTML = `
      <div class="flex-1 bg-white"></div>
      <div class="px-2 py-1 text-[11px] text-center">
        <div class="truncate">${product.name}</div>
        <div class="font-semibold">$${product.price}</div>
      </div>
    `;

        // ÈªûÂïÜÂìÅ ‚Üí ÊääÁõÆÂâçÈÅ∏‰∏≠ÁöÑÊßΩ‰ΩçÂÖßÂÆπÊîπÊàêÈÄôÂÄãÂïÜÂìÅ
        card.addEventListener("click", () => {
          // ‰øùÈö™‰∏ÄÈªûÔºöÂ¶ÇÊûúÂÆåÂÖ®Ê≤íÈÅ∏ÈÅéÔºåÂ∞±ÈªòË™çÁî®Á¨¨ 0 Ê†º
          if (currentSlot == null) currentSlot = 0;

          slotData[currentSlot] = {
            name: product.name,
            price: product.price,
          };

          renderSlots(); // ÈáçÊñ∞Áï´‰∏äÈù¢ÈÇ£Êéí
        });

        return card;
      }

      // Áî¢Áîü 20 ÂºµÂïÜÂìÅÂç°Áâá
      products.forEach((p) => {
        productGrid.appendChild(createProductCard(p));
      });
    </script>
  </body>
</html>
